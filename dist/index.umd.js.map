{"version":3,"file":"index.umd.js","sources":["../util.js","../applyProps.js","../makeCE.js","../index.js"],"sourcesContent":["export function getGlobal() {\n  if (typeof globalThis !== \"undefined\") return globalThis;\n  Object.defineProperty(Object.prototype, \"__this\", {\n    enumerable: true,\n    configurable: true,\n    get: function() {\n      return this;\n    }\n  });\n  const a = __this;\n  delete Object.prototype.__this;\n  return a;\n}\nconst supportsFrom = \"from\" in Array;\nconst supportsCreate = \"create\" in Object;\n\nfunction create(type) {\n  if (supportsCreate) return Object.create(type);\n  return {};\n}\n\n/**\n * @template T\n * @param {Array<T>} arrLike\n * @returns {Array<T>}\n */\nexport function arrFrom(arrLike) {\n  if (supportsFrom) {\n    return Array.from(arrLike);\n  }\n  const len = arrLike.length;\n  const ret = Array(len);\n  for (let i = 0; i < len; i++) {\n    ret[i] = arrLike[i];\n  }\n  return ret;\n}\nexport const EMPTY_OBJ = create(null);\n","import { arrFrom } from \"./util.js\";\n/**\n *\n * @param {HTMLElement} el\n * @param {{[key:string]:any}} props\n */\nexport function recursivelyApplyProps(el, props, recursive, customElement) {\n  /**\n   * @type {HTMLElement[]}\n   */\n  const children = arrFrom(el.children);\n  for (const child of children) {\n    child.customElement = customElement;\n    const ds = child.dataset;\n    for (let prop in ds) {\n      const val = ds[prop];\n      let v = props[val];\n      prop = prop === \"class\" ? \"className\" : prop;\n      if (prop[0] === \"o\" && prop[1] === \"n\") {\n        v = v.bind(child);\n        let fn;\n        if (!child.hasAttribute(\"updates-reactively\")) {\n          fn = v;\n        } else {\n          if (recursive) continue;\n          fn = function() {\n            const args = arrFrom(arguments);\n            v.apply(null, args);\n            recursivelyApplyProps(el, props, true, customElement);\n          };\n        }\n        const evt = prop.substr(2);\n        child._events || (child._events = {});\n        if (!child._events[evt]) {\n          child.addEventListener(evt, eventListenerProxy);\n        }\n        child._events[evt] = fn;\n      } else {\n        child[prop] = v;\n      }\n    }\n    recursivelyApplyProps(child, props, false, customElement);\n  }\n}\n\nfunction eventListenerProxy(e) {\n  this._events[e.type](e);\n}\n","import { recursivelyApplyProps } from \"./applyProps.js\";\nimport { getGlobal } from \"./util.js\";\n\nconst installStringReflection = (obj, attrName, propName = attrName) => {\n  Object.defineProperty(obj, propName, {\n    enumerable: true,\n    get() {\n      const value = this.getAttribute(attrName);\n      return value === null ? \"\" : value;\n    },\n    set(v) {\n      this.setAttribute(attrName, v);\n    }\n  });\n};\n\nconst installBoolReflection = (obj, attrName, propName = attrName) => {\n  Object.defineProperty(obj, propName, {\n    enumerable: true,\n    get() {\n      return this.hasAttribute(attrName);\n    },\n    set(v) {\n      if (v) {\n        this.setAttribute(attrName, \"\");\n      } else {\n        this.removeAttribute(attrName);\n      }\n    }\n  });\n};\nconst gl = getGlobal();\nfunction setupAttrChangedCallBack(proto) {\n  Object.defineProperty(proto, \"attributeChangedCallback\", {\n    value(prop, oldVal, newVal) {\n      return this.__attrListeners[prop].call(this, oldVal, newVal);\n    }\n  });\n}\n/**\n *\n * @param {HTMLTemplateElement} t\n * @param {{[key:string]:any}} pr\n * @param {{}} opts\n */\nexport function makeCE(t, pr, opts) {\n  const name = t.getAttribute(\"custom-element\");\n  const cls = class extends HTMLElement {\n    constructor() {\n      super();\n      this.s = this.attachShadow({\n        mode: \"open\"\n      });\n      this.s.appendChild(t.content.cloneNode(!0));\n      this.config = Object.assign({}, name in opts ? opts[name] : opts);\n      recursivelyApplyProps(this.s, this.config, false, this);\n      this.update = () =>\n        recursivelyApplyProps(this.s, this.config, true, this);\n    }\n  };\n  const { modifyConstructor, modifyPrototype, observedAttributes } = pr;\n  const clsProto = cls.prototype;\n  modifyConstructor && modifyConstructor(cls);\n  modifyPrototype && modifyPrototype(clsProto);\n  if (observedAttributes) {\n    generateAttrObservers(observedAttributes, cls, clsProto);\n  }\n  gl.customElements.define(name, cls);\n}\n\nfunction generateAttrObservers(observedAttributes, cls, clsProto) {\n  const data = {};\n  const obs = [];\n  setupAttrChangedCallBack(clsProto);\n  for (const attr of observedAttributes) {\n    const n = attr.type;\n    const cb = attr.listener;\n    const prop = attr.prop;\n    data[prop] = cb;\n    obs.push(prop);\n    if (typeof attr === \"string\" || n == null || n === \"string\") {\n      installStringReflection(clsProto, prop);\n    } else {\n      if (n === \"bool\") {\n        installBoolReflection(clsProto, prop);\n      }\n    }\n  }\n  cls.observedAttributes = obs;\n  Object.defineProperty(clsProto, \"__attrListeners\", {\n    value: data\n  });\n}\n","import { arrFrom, EMPTY_OBJ } from \"./util.js\";\nimport { makeCE } from \"./makeCE.js\";\nconst REQUIRED_SELECTOR = \"template[is='custom']\";\nexport const init = (protoData, props, templateArray) => {\n  protoData = protoData || {};\n  /**\n   * @type {HTMLTemplateElement[]}\n   */\n  let c;\n  if (templateArray) {\n    if (!Array.isArray(templateArray)) c = [templateArray];\n    else c = templateArray;\n  } else c = arrFrom(document.querySelectorAll(REQUIRED_SELECTOR));\n  for (const i of c) {\n    makeCE(\n      i,\n      protoData[i.getAttribute(\"custom-element\")] || EMPTY_OBJ,\n      props || EMPTY_OBJ\n    );\n  }\n};\nexport const htmlImport = async function(pd, props, url) {\n  const data = await fetch(url);\n  const text = await data.text();\n  const tpl = document.createElement(\"template\");\n  tpl.innerHTML = text;\n  const node = tpl.content.cloneNode(!0);\n  console.log(node);\n  const nodeArr = arrFrom(node.querySelectorAll(REQUIRED_SELECTOR));\n  return init(pd, props, nodeArr);\n};\n"],"names":["supportsFrom","Array","arrFrom","arrLike","from","len","length","ret","i","EMPTY_OBJ","Object","create","recursivelyApplyProps","el","props","recursive","customElement","children","child","ds","dataset","v","prop","fn","bind","hasAttribute","args","arguments","apply","evt","substr","_events","addEventListener","eventListenerProxy","e","this","type","installStringReflection","obj","attrName","propName","defineProperty","enumerable","get","value","getAttribute","set","setAttribute","installBoolReflection","removeAttribute","gl","globalThis","prototype","configurable","a","__this","getGlobal","makeCE","t","pr","opts","name","cls","_this","s","attachShadow","mode","appendChild","content","cloneNode","config","assign","update","HTMLElement","modifyConstructor","modifyPrototype","observedAttributes","clsProto","data","obs","oldVal","newVal","__attrListeners","call","attr","n","listener","push","generateAttrObservers","customElements","define","init","protoData","templateArray","isArray","document","querySelectorAll","pd","url","fetch","text","tpl","createElement","innerHTML","node","console","log","nodeArr"],"mappings":"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"}